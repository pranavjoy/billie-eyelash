<html>
<head>
    <style>
        html {
            height: 100vh;
            color: white;
        }

        canvas {
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            position: absolute;
        }

        #sources {
            display: none;
        }

    </style>
</head>

<body>

<div id="stack">
    <canvas id="obj1"></canvas>
    <canvas id="obj2"></canvas>
    <canvas id="obj3"></canvas>
    <canvas id="obj4"></canvas>
    <canvas id="obj5"></canvas>
    <canvas id="obj6"></canvas>
    <canvas id="obj7"></canvas>
    <canvas id="output"></canvas>
</div>

<div id="sources">
    <img id="xtra" crossorigin="anonymous" src="static/images/new_underbed_flash.png"/>
    <img id="base" crossorigin="anonymous" src="static/images/underbed_noflash.png"/>
    <img id="circle" crossorigin="anonymous" src="static/images/black_circle.png"/>
</div>
</body>
<script>
    let visibility = 0;
    let music_played = [];
    let size = 0;
    let cursor_status = true;

    const canvas = document.getElementById("output");
    const obj1 = document.getElementById("obj1");
    const obj2 = document.getElementById("obj2");
    const obj3 = document.getElementById("obj3");
    const obj4 = document.getElementById("obj4");
    const obj5 = document.getElementById("obj5");
    const obj6 = document.getElementById("obj6");
    const obj7 = document.getElementById("obj7");

    const context = canvas.getContext("2d");
    const contextObj1 = obj1.getContext("2d");
    const contextObj2 = obj2.getContext("2d");
    const contextObj3 = obj3.getContext("2d");
    const contextObj4 = obj4.getContext("2d");
    const contextObj5 = obj5.getContext("2d");
    const contextObj6 = obj6.getContext("2d");
    const contextObj7 = obj7.getContext("2d");

    sources = document.getElementById('sources'),
        imgBase = document.getElementById('base'),
        imgXtra = document.getElementById('xtra');
    circle = document.getElementById('circle');

    C_note = new sound("sound.mp3");
    flashlight = new sound("flashlight.mp3")

    function sound(src) {
        this.sound = document.createElement("audio");
        this.sound.src = src;
        this.sound.setAttribute("preload", "auto");
        this.sound.setAttribute("controls", "none");
        this.sound.style.display = "none";
        document.body.appendChild(this.sound);
        this.play = function () {
            this.sound.play();
        };
        this.stop = function () {
            this.sound.pause();
            this.sound.load();
        };
    }

    const mousePosition = {
        x: 0,
        y: 0
    };

    function resize(canvasID) {
        canvasID.width = window.innerWidth;
        canvasID.height = window.innerHeight;
    }

    function draw() {
        resize(canvas);
        resize(obj1);
        resize(obj2);
        resize(obj3);
        resize(obj4);
        resize(obj5);
        resize(obj6);
        resize(obj7);

        context.drawImage(imgBase, 0, 0);
        context.save();

        contextObj1.arc(523, 430, 90, 0, 2 * Math.PI);
        contextObj2.arc(236, 603, 110, 0, 2 * Math.PI);
        contextObj3.arc(750, 586, 70, 0, 2 * Math.PI);
        contextObj4.arc(947, 474, 50, 0, 2 * Math.PI);
        contextObj5.arc(1149, 400, 51, 0, 2 * Math.PI);
        contextObj6.arc(1300, 588, 70, 0, 2 * Math.PI);
        contextObj7.arc(1411, 329, 70, 0, 2 * Math.PI);

        context.beginPath();
        const position = mousePosition;

        if (visibility % 2 === 0) {
            let timeElapsed = 0;
        } else {
            context.arc(position.x, position.y, 100, 0, 2 * Math.PI);

            context.clip();
            context.drawImage(imgXtra, 0, 0);
            context.restore();
        }

        if (contextObj1.isPointInPath(mousePosition.x, mousePosition.y) && visibility % 2 === 1) {
            //note1.play();
            size = music_played.length;
            if (music_played[size - 1] === "note1") {
                console.log(music_played);
            } else {
                music_played.push("note1");
            }

        } else if (contextObj2.isPointInPath(mousePosition.x, mousePosition.y) && visibility % 2 === 1) {
            //note2.play();
            size = music_played.length;
            if (music_played[size - 1] === "note2") {
                let x = 0;
            } else {
                music_played.push("note2");
            }
        } else if (contextObj3.isPointInPath(mousePosition.x, mousePosition.y) && visibility % 2 === 1) {
            //note3.play();
            size = music_played.length;
            if (music_played[size - 1] === "note3") {
                let x = 0;
            } else {
                music_played.push("note3");
            }
        } else if (contextObj4.isPointInPath(mousePosition.x, mousePosition.y) && visibility % 2 === 1) {
            //note4.play();
            size = music_played.length;
            if (music_played[size - 1] === "note4") {
                let x = 0;
            } else {
                music_played.push("note4");
            }
        } else if (contextObj5.isPointInPath(mousePosition.x, mousePosition.y) && visibility % 2 === 1) {
            //note5.play();
            size = music_played.length;
            if (music_played[size - 1] === "note5") {
                let x = 0;
            } else {
                music_played.push("note5");
            }
        } else if (contextObj6.isPointInPath(mousePosition.x, mousePosition.y) && visibility % 2 === 1) {
            //note6.play();
            size = music_played.length;
            if (music_played[size - 1] === "note6") {
                let x = 0;
            } else {
                music_played.push("note6");
            }
        } else if (contextObj7.isPointInPath(mousePosition.x, mousePosition.y) && visibility % 2 === 1) {
            //note7.play();
            size = music_played.length;
            while (music_played.length > 0) {
                music_played.pop();
            }
        } else {
            console.log("No notes played");
        }
        window.requestAnimationFrame(draw);

    }

    function onMouseMove(event) {
        mousePosition.x = event.clientX;
        mousePosition.y = event.clientY;
    }

    function onclick() {
        flashlight.play();
        visibility += 1;
        if (visibility % 2 == 1) {
            cursor_status = false;
            setCursor(cursor_status);
        } else {
            cursor_status = true;
            setCursor(cursor_status);
        }
    }

    function setCursor(cursor_status) {
        if (cursor_status === true) {
            document.getElementById("output").style.cursor = "auto";
            document.getElementById("obj1").style.cursor = "auto";
            document.getElementById("obj2").style.cursor = "auto";
            document.getElementById("obj3").style.cursor = "auto";
            document.getElementById("obj4").style.cursor = "auto";
            document.getElementById("obj5").style.cursor = "auto";
            document.getElementById("obj6").style.cursor = "auto";
            document.getElementById("obj6").style.cursor = "auto";
            document.getElementById("obj7").style.cursor = "auto";
        } else {
            document.getElementById("output").style.cursor = "none";
            document.getElementById("obj1").style.cursor = "none";
            document.getElementById("obj2").style.cursor = "none";
            document.getElementById("obj3").style.cursor = "none";
            document.getElementById("obj4").style.cursor = "none";
            document.getElementById("obj5").style.cursor = "none";
            document.getElementById("obj6").style.cursor = "none";
            document.getElementById("obj6").style.cursor = "none";
            document.getElementById("obj7").style.cursor = "auto";
        }
        console.log(cursor_status);
    }

    window.addEventListener("mousemove", onMouseMove);
    window.addEventListener("click", onclick);
    window.requestAnimationFrame(draw);

</script>
</html>